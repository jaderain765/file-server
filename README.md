#  파일 저장/불러오기 서버

# 파일 구조 및 데이터 설계

```java

```

## 기능정의

### Controller

#### save

#### load

# 씽크빅

## 썹네일을 원본이미지를 사용할 것인가?

- w, h 값을 인자로 받는다.
- 원하는 이미지의 크기로 임시 이미지를 생성하고, 같은 크기의 이미지 요청이 들어올 경우, 미리 만들어둔 이미지(썹네일)을 전송한다.

`//{ip}:{port}/api/file/image/{UUID}?w=300` 로 요청하면 아래와 같은 순서로 이미지를 불러온다.

1. UUID를 통해 해당하는 이미지가 있는지 찾는다.
2. 크기 제한(w,h)이 있는지 확인한다.
   - 크기 제한이 없다면, File 테이블에서 원본 이미지 정보를 찾은 후 전송한다.
3. 크기 제한이 있다면, ImageTemp 테이블에서 리사이징 된 이미지의 정보를 찾는다.
4. 없을 경우, 임시 이미지를 리사이징 후 저장 및 임시이미지를 반환한다.

이렇게 하면 얻을 수 있는 이점이 있을까?

원본이미지는 용량이 정말정말 클 수도 있다.  
썹네일(미리보기 사진)을 불러오는데, 매번 원본이미지를 가져오면 페이지의 로딩이 많이 걸리게 된다.

이때 개시글 정보를 가져오고, 해당 게시글의 UUID로 된 이미지 이름을 HTML에서 요청 할 것이다.

```html
<!-- 원본 이미지 출력 -->
<img src="//{ip}:{port}/api/file/image/{UUID}" alt="원본 이미지입니다." />

<!-- 너비 300px인 썹네일 이미지(용량 작음) -->
<img src="//{ip}:{port}/api/file/image/{UUID}?w=300" alt="미리보기 이미지입니다." />

<!-- 높이 500px인 썹네일 이미지(용량 작음) -->
<img src="//{ip}:{port}/api/file/image/{UUID}?h=500" alt="미리보기 이미지입니다." />
```

이젠 위와 같은 방식으로 이미지를 불러올 수 있게 된다.

이젠 아까와 달리, 미리 만들어둔 썹네일 이미지를 불러오며, 전송하는 데이터량이 압도적으로 줄어드는 모습을 볼 수 있다.

```java
/** 임시 이미지 */
public class ImageTempEntity {
    @Id
    private String UUID; // 파일 고유 코드(제한크기) (ex : uuid + (w=300,y=340))
    private Long width; // 이미지 가로제한
    private Long height; // 이미지 세로제한
    private LocalDateTime saveDt; // 저장 일자
    private LocalDate loadDate; // 불러온 날짜
}
```

만약 페이지 로딩 속도를 빠르게 하기 위하여, 이미지 저장 시 여러 사이즈 별로 이미지를 저장한다고 생각해보자.  
사용하게 될지, 사용하더라도 얼마나 사용할지도 알 수 없는 이미지를 몇장씩이나 만들어둬야 한다.

리소스 적으로 정말 낭비이다.  
임시 이미지를 불러올 때, 최근 불러온 날짜(loadDate)를 업데이트 하게 한다.  
나중에 용량이 부족할 때나, 배치를 사용하여 오랫동안 사용되지 않은 임시 이미지는 삭제할 수 있도록 한다.

